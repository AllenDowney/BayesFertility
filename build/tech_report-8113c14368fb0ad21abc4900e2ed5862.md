# Technical Report: Bayesian Fertility Rate Projections

## Executive Summary

This report presents a Bayesian statistical model for projecting cohort fertility rates using US Census Current Population Survey (CPS) data spanning 1976-2024. The model uses a hierarchical log-linear structure with Gaussian random walk priors to capture smooth temporal changes in age-specific fertility patterns across birth cohorts.

**Key findings:**
- Cohort Completed Fertility Rates (CFR) have been declining for cohorts born after 1980
- Model projections suggest CFR could drop below 1.0 for cohorts born in the 2000s
- Backtesting demonstrates good agreement with historical Census data
- The resampling approach successfully incorporates survey weights while maintaining model tractability

## 1. Introduction

### 1.1 Motivating Question

Fertility rates in the United States have been declining for several decades. Period fertility rates (Total Fertility Rate, or TFR) provide a snapshot of births in a given year, but they can be influenced by timing effects—women delaying childbearing can depress TFR even if lifetime fertility remains unchanged.

**Cohort fertility rates** provide a more stable measure of long-term reproductive patterns by following specific birth cohorts throughout their reproductive years. The key question is: **How many children will recent birth cohorts (those born in the 1990s and 2000s) have over their lifetimes?**

This question has profound implications for:
- **Population projections**: Future population size and age structure
- **Economic planning**: Labor force projections and dependency ratios
- **Policy design**: Education, healthcare, childcare, and retirement systems
- **Social understanding**: Changing family formation patterns and societal values

### 1.2 Challenges

Projecting cohort fertility presents several challenges:

1. **Incomplete data**: Younger cohorts are still in their reproductive years
2. **Survey weights**: CPS uses complex sampling; results must reflect the population
3. **Uncertainty quantification**: Point estimates are insufficient; we need credible intervals
4. **Model validation**: How can we trust projections for cohorts that haven't completed fertility?

### 1.3 Our Approach

We address these challenges using a **Bayesian hierarchical model** that:

- Models age-specific birth rates (ASBR) across cohorts using log-linear structure
- Uses Gaussian random walk priors to enforce smooth temporal changes
- Incorporates survey weights through resampling
- Provides full posterior distributions for all parameters and predictions
- Validates against historical data through backtesting

## 2. Data

### 2.1 Data Sources

#### Current Population Survey (CPS)

The CPS is a monthly household survey conducted by the US Census Bureau. In June of most years, it includes a Fertility Supplement asking women about their childbearing history.

**IPUMS CPS Data** (Extract 13):
- Years: June 1976 through June 2024 (29 surveys)
- Sample size: ~600,000 female respondents aged 15-44 across all years
- Key variables: `YEAR`, `AGE`, `FERTYR` (births in past year), `NCHILD` (own children in household), `WTFINL` (survey weight)

**Sampling**:
- The CPS uses a stratified multi-stage sampling design
- Survey weights (`WTFINL`) are provided to make results representative of the US population
- Weights account for sampling design, non-response, and post-stratification adjustments

#### Historical Census Tables

For validation, we use Census historical time series tables that provide:
- Cohort fertility rates by birth year
- Age-specific fertility rates over time
- Total Completed Fertility Rates (CFR) for completed cohorts

### 2.2 Data Preprocessing

The preprocessing pipeline involves several steps:

1. **Load data**: Read CPS data from IPUMS extract (`.dta.gz` format)
2. **Variable selection**: Keep only relevant variables for modeling
3. **Cohort construction**: Assign each respondent to a 3-year birth cohort
4. **Age binning**: Group respondents into 3-year age bins (15-17, 18-20, ..., 40-42, 43-44)
5. **Survey weight handling**: Use resampling to incorporate weights
6. **Aggregation**: Compute observed parity for each cohort-age group
7. **Save**: Store preprocessed data in HDF5 format for modeling

See `notebooks/process_cps.ipynb` for full preprocessing code.

### 2.3 Survey Weight Handling: Resampling Approach

**Challenge**: The Bayesian model uses a Poisson likelihood that expects integer counts. Survey-weighted data produces continuous (non-integer) values.

**Solution**: **Resampling with replacement** according to survey weights:

1. Normalize weights within each survey year
2. Resample respondents with probability proportional to their weight
3. This produces a pseudo-sample where each respondent can appear 0, 1, or multiple times
4. The resulting data represents the population rather than just the sample
5. Maintains integer count structure for Poisson likelihood

**Justification**: 
- Resampling is a well-established method in survey statistics
- Preserves the population distribution represented by weights
- Maintains computational tractability for Bayesian inference
- Alternative approaches (weighted likelihood, continuous distributions) introduce additional complexity

### 2.4 Data Structure

After preprocessing, the data is organized as:

- **Dimensions**: Cohort × Age Group
- **Observations**: Total parity (number of children) for each cohort-age group
- **Sample size**: Number of respondents in each cohort-age group (after resampling)

Example structure:
```
Cohort: 1975-1977
  Age 15-17: 5 children among 1,200 respondents
  Age 18-20: 45 children among 1,180 respondents
  ...
  Age 40-42: 2,100 children among 1,050 respondents
```

## 3. Model

### 3.1 Model Structure

The model uses a **hierarchical log-linear structure** to capture fertility patterns:

**Age-Specific Birth Rates (ASBR)**:
```
λ[cohort, age] = exp(α[cohort] + β[age])
```

Where:
- `α[cohort]`: Cohort effect (log-scale baseline fertility for each cohort)
- `β[age]`: Age effect (log-scale age-specific fertility pattern)
- `λ[cohort, age]`: Expected births per person in cohort at age

**Cumulative Parity**:
The cumulative number of children for each cohort at each age is the sum of ASBRs:
```
μ[cohort, age] = Σ λ[cohort, age'] × n[cohort, age']
                  age'≤age
```

Where `n[cohort, age]` is the number of respondents.

**Likelihood**:
Observed parity follows a Poisson distribution:
```
observed_parity[cohort, age] ~ Poisson(μ[cohort, age])
```

### 3.2 Prior Specifications

**Cohort effects (α)**: Gaussian random walk
```
α[0] ~ Normal(0, 1)
α[i] ~ Normal(α[i-1], σ_α) for i > 0
σ_α ~ HalfNormal(0.1)
```

This prior enforces smooth changes across cohorts while allowing flexibility to capture trends.

**Age effects (β)**: Gaussian random walk
```
β[0] ~ Normal(0, 1)
β[j] ~ Normal(β[j-1], σ_β) for j > 0
σ_β ~ HalfNormal(0.1)
```

This captures the characteristic age-fertility curve (low at young ages, peak in late 20s/early 30s, decline thereafter).

### 3.3 Model Versions

**Version 2.0** (current):
- Fixed `σ_α = σ_β = 0.1` (reasonable values based on exploration)
- Computationally efficient
- Produces stable results

**Version 3.0** (experimental):
- Treats `σ_α` and `σ_β` as hyperparameters with HalfNormal priors
- More flexible but computationally intensive
- Currently commented out in notebooks

### 3.4 Inference

**MCMC Sampling**:
- Sampler: PyMC default (NUTS)
- Chains: 4 independent chains
- Samples: 1,000 draws per chain (after 1,000 tuning samples)
- Total: 4,000 posterior samples

**Convergence diagnostics**:
- R̂ (Gelman-Rubin statistic): Should be < 1.01
- Effective sample size: Should be > 400 per chain
- Trace plots: Should show good mixing

### 3.5 Predictions

**Cohort Completed Fertility Rate (CFR)**:
For each cohort and each posterior sample:
1. Compute λ[cohort, age] for all ages up to age 44 (end of reproductive years)
2. Sum across ages to get predicted CFR
3. This produces a posterior distribution over CFR for each cohort

**Uncertainty quantification**:
- Posterior mean: Best point estimate
- 94% HDI (Highest Density Interval): Credible interval capturing uncertainty

## 4. Results

### 4.1 Model Fit

*[To be added: Figures showing posterior distributions for α and β]*

**Cohort effects (α)**:
- Declining trend for cohorts born after 1980
- Indicates lower baseline fertility for recent cohorts

**Age effects (β)**:
- Characteristic age-fertility curve
- Peak fertility in late 20s to early 30s
- Low fertility at very young and older ages

### 4.2 Validation: Backtesting

To validate the model, we perform **backtesting**: fitting the model with data up to various cutoff years and comparing predictions to actual outcomes.

*[To be added: Figures showing backtesting results]*

**Method**:
1. Fit model using data only up to year T (e.g., T = 2000)
2. Generate predictions for future cohorts
3. Compare predictions to actual observed data from years after T

**Results**:
- Good agreement between predictions and actual data
- Model successfully captures fertility trends
- Increases confidence in projections for incomplete cohorts

### 4.3 Cohort Fertility Projections

*[To be added: Figure showing projected CFR by birth cohort]*

**Key findings**:

- **Historical cohorts** (born 1940s-1970s): CFR ≈ 2.0-2.2 children per woman
- **Recent cohorts** (born 1980s-1990s): CFR declining toward 1.5-1.8
- **Future cohorts** (born 2000s-2010s): Projected CFR < 1.5, potentially below 1.0

**Uncertainty**: 
- Projections for incomplete cohorts have wider credible intervals
- Uncertainty increases for younger cohorts still in reproductive years

### 4.4 Comparison with Census Data

*[To be added: Figure comparing model predictions to Census historical tables]*

The model predictions align well with Census historical data on cohort fertility, providing additional validation.

## 5. Discussion

### 5.1 Interpretation

The declining fertility trend for recent cohorts reflects several factors:
- **Delayed childbearing**: Women having children at older ages
- **Economic factors**: Rising costs of childcare, education, housing
- **Educational attainment**: Higher education associated with lower fertility
- **Career priorities**: Increased labor force participation
- **Access to contraception**: Better family planning technologies
- **Social changes**: Evolving attitudes toward family size

### 5.2 Implications

**If current trends continue**:
- US population growth will slow or potentially become negative
- Dependency ratios will increase (fewer workers per retiree)
- Immigration may become more important for population growth
- Economic and social policies may need to adapt to lower fertility

### 5.3 Model Strengths

1. **Comprehensive data**: Nearly 50 years of CPS data
2. **Proper weight handling**: Resampling approach maintains population representativeness
3. **Uncertainty quantification**: Full posterior distributions for all parameters
4. **Validation**: Backtesting against historical data
5. **Interpretability**: Parameters have clear demographic meanings

### 5.4 Limitations

1. **Projection uncertainty**: Predictions for young cohorts have high uncertainty
2. **Trend assumptions**: Model assumes smooth continuation of trends
3. **External shocks**: Cannot predict sudden changes (e.g., pandemic effects, policy changes)
4. **Data limitations**: CPS survey has limitations (coverage, response rates)
5. **Model simplicity**: Does not account for socioeconomic heterogeneity, education, etc.

### 5.5 Future Directions

Potential extensions:
- **Subgroup analysis**: Model fertility by education, race/ethnicity, region
- **Covariate effects**: Include economic indicators, policy variables
- **Alternative models**: Explore different prior specifications, likelihood functions
- **International comparison**: Apply to other countries' data
- **Policy scenarios**: Model impact of pro-natalist policies

## 6. Conclusions

This project demonstrates the value of Bayesian methods for demographic projection:

1. **Fertility is declining** for recent cohorts, with potential for CFR below replacement level
2. **Model validation** shows good agreement with historical data, increasing confidence in projections
3. **Resampling approach** successfully handles survey weights in a Bayesian framework
4. **Uncertainty quantification** is essential for understanding projection reliability

The projected decline in cohort fertility has important implications for population dynamics, economic planning, and social policy. While substantial uncertainty remains for incomplete cohorts, the model provides a principled framework for projecting future fertility based on historical patterns.

## References

*[To be added]*

- IPUMS CPS: https://cps.ipums.org/
- US Census Bureau Fertility Data
- Relevant demographic literature on cohort fertility

## Appendix: Code and Reproducibility

All code for this project is available at: https://github.com/AllenDowney/BayesFertility

**Key notebooks**:
- `notebooks/process_cps.ipynb`: Data preprocessing pipeline
- `notebooks/fertility_cps2.ipynb`: Model fitting and analysis (v2.0)
- `notebooks/fertility_cps3.ipynb`: Model fitting and analysis (v3.0)

**Requirements**:
- Python 3.8+
- PyMC 5.0+
- ArviZ, NumPy, Pandas, Matplotlib

See `requirements.txt` for full dependencies.

